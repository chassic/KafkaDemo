### 集群部署方案

#### 环境因素

![img](basic-build.assets/d2a926bc8f448f58bda0d21b7ed39f55.jpeg)



#### 磁盘容量计算

假设你所在公司有个业务每天需要向 Kafka 集群发送 1 亿条消息，每条消息保存两份以防止数据丢失，另外消息默认保存两周时间。现在假设消息的平均大小是 1KB，那么你能说出你的 Kafka 集群需要为这个业务预留多少磁盘空间吗？

计算如下：

- 每天 1 亿条 1KB 大小的消息，保存两份且留存两周的时间，那么总的空间大小就等于

  ```
  1 亿 * 1KB * 2 / 1000 / 1000 = 200GB
  ```

- 索引数据，预留10%空间

  ```
  200 *（1+0.1) = 220GB
  ```

- 保存两周数据

  ```
  220GB * 14 = 3080GB
  ```

- Kafka 支持数据的压缩，假设压缩比是 0.75

  ```
  3080 * 0.75 = 2310GB
  ```

  

  #### 带宽计算

- 假设你公司的机房环境是千兆网络，即 1Gbps。每台 Kafka 服务器只能使用70%带宽。

  ```
  单机带宽 700Mb 
  ```

- 通常要再额外预留出 2/3 的资源，实际可能要预留更多

  ```
  单台服务器使用带宽 700Mb / 3 ≈ 240Mbps
  ```

- 计算 1 小时内处理 1TB 数据所需的服务器数量，每秒需要处理 2336Mb 的数据

  ```
  1000*1000/(60*60)=277MB, 277*8 = 2336Mb
  2336/240=10 台服务器
  ```

- Kafka推荐使用额外复制两份，那么总的服务器台数还要乘以 3

  ```
  10 * 3 = 30 台服务器
  ```

  